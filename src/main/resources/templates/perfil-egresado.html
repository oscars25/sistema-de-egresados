<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="icon" type="image/png" href="/img/favicon.png" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Perfil de Usuario - Egresado</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link th:href="@{/css/style.css}" rel="stylesheet" />
</head>
<body>
<nav class="navbar">
    <div class="navbar-container">
        <div class="navbar-logo d-flex align-items-center">
            <img src="/img/logoues.png" alt="Logo UES" class="logo-img me-2" />
            <span>Portal de Egresados UES</span>
        </div>
        <ul class="navbar-links">
            <li><a th:href="@{/perfil}">Inicio</a></li>
            <li><a th:href="@{/acercade}">Acerca del sitio</a></li>
            <li><a th:href="@{/contacto}">Contacto</a></li>
        </ul>
    </div>
</nav>

<div class="container mt-5 mb-5">
    <div class="p-4 bg-white rounded-4 shadow-lg">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="text-primary fw-bold">Perfil de Usuario</h1>
            <a th:href="@{/logout}" class="btn btn-danger">Cerrar Sesión</a>
        </div>

        <div class="row">
            <div class="col-md-4 text-center">
                <img th:src="${foto}" alt="Foto de Perfil" class="img-fluid rounded-circle" style="width: 150px; height: 150px;" />
            </div>
            <div class="col-md-8">
                <h3 th:text="${usuario}" class="text-primary"></h3>
                <p><strong>Correo Electrónico:</strong> <span th:text="${email}"></span></p>
                <p><strong>Tu rol es:</strong> 
                    <span th:if="${#authorization.expression('hasRole(''EGRESADO'')')}">EGRESADO</span>
                </p>
            </div>
        </div>

        <hr class="my-4" />

<!-- Barra de búsqueda mejorada -->
<div class="container-fluid bg-primary mb-4 wow fadeIn" data-wow-delay="0.1s" style="padding: 35px;">
    <div class="container">
        <form th:action="@{/perfil}" method="get">
            <div class="row g-3 align-items-end">
                <!-- Campo de palabra clave -->
                <div class="col-md-5">
                    <label for="keyword" class="form-label text-white">Palabra clave</label>
                    <input type="text" id="keyword" name="keyword" class="form-control border-0" 
                           placeholder="Buscar por palabra clave" th:value="${keyword}">
                </div>

                <!-- Campo de estado -->
                <div class="col-md-4">
                    <label for="estado" class="form-label text-white">Estado</label>
                    <select id="estado" name="estado" class="form-select border-0">
                        <option value="" th:selected="${estado == null or estado == ''}">Seleccionar estado</option>
                        <option value="ACTIVA" th:selected="${estado == 'ACTIVA'}">ACTIVA</option>
                        <option value="ABIERTA" th:selected="${estado == 'ABIERTA'}">ABIERTA</option>
                        <option value="INACTIVA" th:selected="${estado == 'INACTIVA'}">INACTIVA</option>
                    </select>
                </div>

                <!-- Botón de búsqueda -->
                <div class="col-md-3 d-grid">
                    <button type="submit" class="btn btn-dark btn-lg">Buscar</button>
                </div>
            </div>
        </form>
    </div>
</div>


 <!-- Aquí empieza la lista de ofertas -->
<div class="container mt-4">
<!-- Título dinámico según búsqueda -->
<h2 class="mb-3" th:if="${(keyword != null and keyword != '') or (estado != null and estado != '')}">
    Resultados de la búsqueda
</h2>
<h2 class="mb-3" th:if="${(keyword == null or keyword == '') and (estado == null or estado == '')}">
    Para que aparezcan las ofertas disponibles primero debes realizar una búsqueda
</h2>


    <!-- Mostrar mensaje "no se encontraron ofertas" solo si se hizo búsqueda pero no hay resultados -->
    <div th:if="(${keyword != null and keyword != ''} or (${estado != null and estado != ''})) and ${ofertas.isEmpty()}">
        <p>No se encontraron ofertas para los criterios indicados.</p>
    </div>

    <!-- Mostrar tabla solo si se hizo búsqueda y hay ofertas -->
    <div th:if="(${keyword != null and keyword != ''} or (${estado != null and estado != ''})) and !${ofertas.isEmpty()}">
        <table class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>Descripción</th>
                    <th>Requisitos</th>
                    <th>Fecha de Publicación</th>
                    <th>Estado</th>
                    <th>Empresa</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="oferta : ${ofertas}">
                    <td>
                        <a th:href="@{/ofertas/ver/{id}(id=${oferta.id})}" th:text="${oferta.descripcion}">Descripción</a>
                    </td>
                    <td th:text="${oferta.requisitos}">Requisitos</td>
                    <td th:text="${oferta.fechaPublicacion != null ? #temporals.format(oferta.fechaPublicacion, 'dd/MM/yyyy') : 'Sin fecha'}">Fecha</td>
                    <td th:text="${oferta.estado}">Estado</td>
                    <td th:text="${oferta.empresa != null ? oferta.empresa : 'Sin empresa'}">Empresa</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<!-- Fin lista de ofertas -->

    </div>
</div>

<footer class="bg-dark text-white text-center mt-auto py-3">
    <div class="container">
        <p class="mb-1">Universidad de El Salvador - Portal de Egresados</p>
        <p class="mb-1">© 2025 Todos los derechos reservados</p>
        <p class="mb-0">
            <a href="/privacidad" class="text-white-50 me-3">Política de privacidad</a>
            <a href="/contacto" class="text-white-50">Contacto</a>
        </p>
    </div>
</footer>

<!-- Modal de éxito -->
<div class="modal fade" id="modalExito" tabindex="-1" aria-labelledby="modalExitoLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-success">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="modalExitoLabel">¡Éxito!</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body" th:text="${mensajeModal}">
        <!-- Mensaje de éxito aquí -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de error -->
<div class="modal fade" id="modalError" tabindex="-1" aria-labelledby="modalErrorLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-danger">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="modalErrorLabel">¡Error!</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body" th:text="${mensajeModalError}">
        <!-- Mensaje de error aquí -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script th:inline="javascript">
/*<![CDATA[*/
document.addEventListener('DOMContentLoaded', function () {
    var mostrarModalExito = /*[[${mostrarModalExito} ? 'true' : 'false']]*/ 'false';
    mostrarModalExito = mostrarModalExito === 'true';

    var mostrarModalError = /*[[${mostrarModalError} ? 'true' : 'false']]*/ 'false';
    mostrarModalError = mostrarModalError === 'true';

    if (mostrarModalExito) {
        var modalExito = new bootstrap.Modal(document.getElementById('modalExito'));
        modalExito.show();
    }
    if (mostrarModalError) {
        var modalError = new bootstrap.Modal(document.getElementById('modalError'));
        modalError.show();
    }
});
/*]]>*/
</script>

</body>
</html>
